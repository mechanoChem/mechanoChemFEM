<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>mechanoChemFEM: Example 3 : Allen-Cahn equation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">mechanoChemFEM
   &#160;<span id="projectnumber">0.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="codestructure.html"><span>Code&#160;structure</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="modules.html"><span>Functions</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example 3 : Allen-Cahn equation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>The Allen Cahn equation is: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial C}{\partial t}=-M\mu \]" src="form_152.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mu=\frac{\partial g}{\partial C}-\nabla\cdot k\nabla C \]" src="form_148.png"/>
</p>
<p> where <img class="formulaInl" alt="$g$" src="form_132.png"/> is a non-convex, ``homogeneous'' free energy density function, whose form has been chosen </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ g(C)=\omega(C-C_\alpha)^2(C-C_\beta)^2 \]" src="form_133.png"/>
</p>
<p> The boundary condition is </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla \mu\cdot\boldsymbol{n}=0 \text{ on }\Gamma \]" src="form_139.png"/>
</p>
<p> The double-well non-convex free energy density function, <img class="formulaInl" alt="$g(C)$" src="form_135.png"/>, drives segregation of the system into two distinct types.</p>
<p>Before implementing the code, we rewrite the equation in the form of standard diffusion-reaction equations: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial C}{\partial t}+\nabla\cdot\boldsymbol{j}=r \]" src="form_153.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{j}=-Mk\nabla C \]" src="form_154.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ r=-M\frac{\partial g}{\partial C}=-2M\omega(C-C_\alpha)(C-C_\beta)(2C-C_\alpha-C_\beta) \]" src="form_155.png"/>
</p>
<h1><a class="anchor" id="imple"></a>
Implementation</h1>
<p>We first define the single scalar primary variable: </p>
<div class="fragment"><div class="line">  std::vector&lt;std::vector&lt;std::string&gt; &gt; primary_variables(1);        </div>
<div class="line">primary_variables[0].push_back(<span class="stringliteral">&quot;C&quot;</span>); primary_variables[0].push_back(<span class="stringliteral">&quot;component_is_scalar&quot;</span>);</div>
</div><!-- fragment --><p> and setup the order of basis function for it: </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> number_domain=1;</div>
<div class="line"><span class="keywordtype">int</span> diff_degree=1;</div>
<div class="line">std::vector&lt;std::vector&lt;int&gt; &gt; FE_support(number_domain);<span class="comment">// store order of polynomial basis functions, 0 means FE_Nothing   </span></div>
<div class="line">FE_support[0].push_back(diff_degree);</div>
</div><!-- fragment --><p> Before launching the <a href="../html/classinit_bound_val_probs.html">initBoundValProbs</a>, we need to initialize the <b>ParameterHandler</b> and declare all paramters we may use: </p>
<div class="fragment"><div class="line">ParameterHandler params;</div>
<div class="line">params.enter_subsection(<span class="stringliteral">&quot;Parameters&quot;</span>);  </div>
<div class="line">params.declare_entry(<span class="stringliteral">&quot;omega&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,Patterns::Double() );</div>
<div class="line">params.declare_entry(<span class="stringliteral">&quot;c_alpha&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,Patterns::Double() );</div>
<div class="line"><span class="comment">//... more parameters </span></div>
<div class="line">params.leave_subsection();  </div>
</div><!-- fragment --><p> Now we just need to have class inherited from <a href="../html/classinit_bound_val_probs.html">initBoundValProbs</a> class, and overload the <a href="../html/classinit_bound_val_probs.html#ac8f2c3e2a1040c70b709900dc3dfdaea">get_residual()</a> function: </p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div>
<div class="line"><span class="keyword">class </span>AllenCahn: <span class="keyword">public</span> <a class="code" href="classinit_bound_val_probs.html">initBoundValProbs</a>&lt;dim&gt;</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        AllenCahn(std::vector&lt;std::vector&lt;std::string&gt; &gt; _primary_variables, std::vector&lt;std::vector&lt;int&gt; &gt; _FE_support, ParameterHandler&amp; _params);</div>
<div class="line">        <span class="comment">//this is a overloaded function </span></div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classinit_bound_val_probs.html#ac8f2c3e2a1040c70b709900dc3dfdaea">get_residual</a>(<span class="keyword">const</span> <span class="keyword">typename</span> hp::DoFHandler&lt;dim&gt;::active_cell_iterator &amp;cell, <span class="keyword">const</span> FEValues&lt;dim&gt;&amp; fe_values, Table&lt;1, Sacado::Fad::DFad&lt;double&gt; &gt;&amp; R, Table&lt;1, Sacado::Fad::DFad&lt;double&gt;&gt;&amp; ULocal, Table&lt;1, double &gt;&amp; ULocalConv);</div>
<div class="line">        ParameterHandler* <a class="code" href="classinit_bound_val_probs.html#a31d5e7a5228d9d55ba00fae854fcfaa0">params</a>;       </div>
<div class="line">};</div>
</div><!-- fragment --><p> In the overloaded <b>get_residual</b> function, we define the residual for our problem. As our equation is standrad diffusion-reaction, we can simiply use the pre-defined model: </p>
<div class="fragment"><div class="line">this-&gt;ResidualEq.<a class="code" href="class_residual.html#a144663fb81fc60d4db0c5a8e45176e61">residualForDiff_ReacEq</a>(fe_values, 0, R, C, C_conv, j_C, rhs_C);</div>
</div><!-- fragment --><p>fe_values: deal.ii Finite element evaluated in quadrature points of a cell.</p>
<p>R: residual vector of a cell.</p>
<p>C: the order parameter at current time step.</p>
<p>C_conv: the order parameter at last time step.</p>
<p>j_C: the flux term</p>
<p>rhs_C: the reaction term. </p>
<hr/>
<p>Before we call these two functions, we need the flux and reactions term, we need to first evaluate the values of the primary field and the spatial gradient. We also need to evaluate the value of primary field at previous time step for the Backward Euler time scheme: </p>
<div class="fragment"><div class="line">dealii::Table&lt;1,double&gt;  C_conv(n_q_points);</div>
<div class="line">dealii::Table&lt;1,Sacado::Fad::DFad&lt;double&gt; &gt;  C(n_q_points);</div>
<div class="line">dealii::Table&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt;  C_grad(n_q_points, dim);</div>
<div class="line"></div>
<div class="line">evaluateScalarFunction&lt;double,dim&gt;(fe_values, 0, ULocalConv, C_conv);</div>
<div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, 0, ULocal, C); </div>
<div class="line">evaluateScalarFunctionGradient&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, 0, ULocal, C_grad);</div>
<div class="line"></div>
<div class="line"><span class="comment">//evaluate diffusion and reaction term</span></div>
<div class="line">dealii::Table&lt;1,Sacado::Fad::DFad&lt;double&gt; &gt; rhs_C(n_q_points);</div>
<div class="line">dealii::Table&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt; j_C(n_q_points, dim);</div>
<div class="line"></div>
<div class="line">j_C=table_scaling&lt;Sacado::Fad::DFad&lt;double&gt;, dim&gt;(C_grad,-kappa*M);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q=0; q&lt;n_q_points;q++){</div>
<div class="line">     rhs_C[q]=-M*(2*omega*(C[q]-c_alpha)*(C[q]-c_beta)*(2*C[q]-c_alpha-c_beta));</div>
<div class="line"> }</div>
</div><!-- fragment --><p> The last thing we need to define is the initial condition, we can simpily overload the <a href="../html/class_initial_conditions.html#a369cea7ba74f8cd0a6ca12e0c164ff74">value()</a> function of the <a href="../html/class_initial_conditions.html">InitialConditions </a> class to define the initial condition for single scalar field. </p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> <a class="code" href="class_initial_conditions.html#af07c55aae0a37d719b86b6471bd9422f">InitialConditions&lt;dim&gt;::value</a>(<span class="keyword">const</span> Point&lt;dim&gt;   &amp;p, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>  component)<span class="keyword"> const</span>{</div>
<div class="line">  <span class="keywordflow">return</span> 0.5 + 0.2*(static_cast &lt;<span class="keywordtype">double</span>&gt; (rand())/(static_cast &lt;double&gt;(RAND_MAX))-0.5); </div>
<div class="line">}</div>
</div><!-- fragment --><p>The complete implementaion can be found at <a href="https://github.com/mechanoChem/mechanoChemFEM/tree/example/Example3_Allen-Cahn">Github</a>. The results are generated using paramters shown below. </p>
<h1><a class="anchor" id="file"></a>
User interface: parameter file</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#parameters file</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">subsection Problem</div>
<div class="line">set print_parameter = <span class="keyword">true</span></div>
<div class="line"></div>
<div class="line">set dt = 1</div>
<div class="line">set totalTime = 50</div>
<div class="line">set current_increment = 0</div>
<div class="line">set off_output_index=0</div>
<div class="line">set current_time = 0</div>
<div class="line">set resuming_from_snapshot = <span class="keyword">false</span></div>
<div class="line"></div>
<div class="line">set output_directory = output/</div>
<div class="line">set snapshot_directory = snapshot/</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#FEM</span></div>
<div class="line"><span class="preprocessor"></span>set volume_quadrature = 3 </div>
<div class="line">set face_quadrature = 2 </div>
<div class="line">end</div>
<div class="line"></div>
<div class="line">subsection Geometry</div>
<div class="line">set X_0 = 0</div>
<div class="line">set Y_0 = 0</div>
<div class="line">set Z_0 = 0</div>
<div class="line">set X_end = 1 </div>
<div class="line">set Y_end = 1</div>
<div class="line">set Z_end = 2.0 #no need to 2D</div>
<div class="line"></div>
<div class="line">set element_div_x=100</div>
<div class="line">set element_div_y=100</div>
<div class="line">set element_div_z=5 #no need to 2D</div>
<div class="line">end</div>
<div class="line"></div>
<div class="line">subsection Parameters</div>
<div class="line">set omega = 0.8</div>
<div class="line">set c_alpha = 0.2</div>
<div class="line">set c_beta = 0.8</div>
<div class="line">set kappa = 0.001</div>
<div class="line">set M=1</div>
<div class="line">end</div>
<div class="line">                        </div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># parameters reserved for deal.ii first level code:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#nonLinear_method : classicNewton</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#solver_method (direct) : PETScsuperLU, PETScMUMPS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#solver_method (iterative) : PETScGMRES PETScBoomerAMG</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#relative_norm_tolerance, absolute_norm_tolerance, max_iterations</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"></span>subsection Nonlinear_solver</div>
<div class="line">        set nonLinear_method = classicNewton</div>
<div class="line">        set relative_norm_tolerance = 1.0e-12</div>
<div class="line">        set absolute_norm_tolerance = 1.0e-12</div>
<div class="line">        set max_iterations = 10</div>
<div class="line">end</div>
<div class="line">                        </div>
<div class="line">subsection Linear_solver</div>
<div class="line">        set solver_method = PETScsuperLU</div>
<div class="line">        set system_matrix_symmetricFlag = <span class="keyword">false</span> # <span class="keywordflow">default</span> is <span class="keyword">false</span></div>
<div class="line">end</div>
</div><!-- fragment --><h1><a class="anchor" id="results"></a>
Results</h1>
 <style>div.image img[src="E3.png"]{width:600px;}</style>  <div class="image">
<img src="E3.png" alt="E3.png"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
