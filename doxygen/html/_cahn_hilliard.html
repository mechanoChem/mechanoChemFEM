<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mechanoChemFEM: Example 2 : CahnHilliard with single species</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mechanoChemFEM
   &#160;<span id="projectnumber">0.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example 2 : CahnHilliard with single species </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>The Cahn-Hilliard equation is: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial C}{\partial t}=\nabla\cdot(M\nabla\mu) \]" src="form_133.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mu=\frac{\partial g}{\partial C}-\nabla\cdot k\nabla C \]" src="form_134.png"/>
</p>
<p> where <img class="formulaInl" alt="$g$" src="form_135.png"/> is a non-convex, `&lsquo;homogeneous&rsquo;' free energy density function, whose form has been chosen </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ g(C)=\omega(C-C_\alpha)^2(C-C_\beta)^2 \]" src="form_136.png"/>
</p>
<p> The boundary condiiton is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla\mu\cdot\boldsymbol{n}=0;\quad \nabla C\cdot\boldsymbol{n}=0 \text{ on }\Gamma \]" src="form_137.png"/>
</p>
<p> The double-well non-convex free energy density function, <img class="formulaInl" alt="$g(C)$" src="form_138.png"/>, drives segregation of the system into two distinct types.</p>
<p>Attention is called to the well-known fourth-order nature of this partial differential equation in the concentration <img class="formulaInl" alt="$C$" src="form_139.png"/>. The polynomial basis can only achieve C0 continuity across the element. To overcome this difficuity, we split the equation into two equations: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial C}{\partial t}+\nabla\cdot(-M\nabla\mu)=0 \]" src="form_140.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ k\nabla^2 C=\frac{\partial g}{\partial C}-\mu \]" src="form_141.png"/>
</p>
<p> The first equation is diffusion equation, and the second one the Possion equation. </p>
<h1><a class="anchor" id="imple"></a>
Implementation: level 1 user</h1>
<p>We first define the two scalar primary variables: </p><div class="fragment"><div class="line">std::vector&lt;std::vector&lt;std::string&gt; &gt; primary_variables(2);        </div><div class="line">      primary_variables[0].push_back(<span class="stringliteral">&quot;c1&quot;</span>); primary_variables[0].push_back(<span class="stringliteral">&quot;component_is_scalar&quot;</span>);</div><div class="line">      primary_variables[1].push_back(<span class="stringliteral">&quot;mu&quot;</span>); primary_variables[1].push_back(<span class="stringliteral">&quot;component_is_scalar&quot;</span>);</div></div><!-- fragment --><p> and we solve both species in one domain. We define the domain and basis order for each primal variables: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> number_domain=1;</div><div class="line"><span class="keywordtype">int</span> diff_degree=1;</div><div class="line">std::vector&lt;std::vector&lt;int&gt; &gt; FE_support(number_domain);<span class="comment">// store order of polynomial basis functions, 0 means FE_Nothing   </span></div><div class="line">FE_support[0].push_back(diff_degree);</div><div class="line">FE_support[0].push_back(diff_degree);</div></div><!-- fragment --><p> Before launching the <a href="../html/classinit_bound_val_probs.html">initBoundValProbs</a>, we need to initialize the <b>ParameterHandler</b> and declare all paramters we may use: </p><div class="fragment"><div class="line">ParameterHandler params;</div><div class="line">params.enter_subsection(<span class="stringliteral">&quot;Concentration&quot;</span>);   </div><div class="line">params.declare_entry(<span class="stringliteral">&quot;omega&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,Patterns::Double() );</div><div class="line">params.declare_entry(<span class="stringliteral">&quot;c_alpha&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,Patterns::Double() );</div><div class="line"><span class="comment">//... more parameters </span></div><div class="line">params.leave_subsection();  </div></div><!-- fragment --><p> Now we just need to have class inherited from <a href="../html/classinit_bound_val_probs.html">initBoundValProbs</a> class, and overload the <a href="../html/classinit_bound_val_probs.html#ac8f2c3e2a1040c70b709900dc3dfdaea">get_residual()</a> function: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keyword">class </span>CahnHilliard: <span class="keyword">public</span> initBoundValProbs&lt;dim&gt;</div><div class="line">{</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        CahnHilliard(std::vector&lt;std::vector&lt;std::string&gt; &gt; _primary_variables, std::vector&lt;std::vector&lt;int&gt; &gt; _FE_support, ParameterHandler&amp; _params);</div><div class="line">        <span class="comment">//this is a overloaded function </span></div><div class="line">        <span class="keywordtype">void</span> get_residual(<span class="keyword">const</span> <span class="keyword">typename</span> hp::DoFHandler&lt;dim&gt;::active_cell_iterator &amp;cell, <span class="keyword">const</span> FEValues&lt;dim&gt;&amp; fe_values, Table&lt;1, Sacado::Fad::DFad&lt;double&gt; &gt;&amp; R, Table&lt;1, Sacado::Fad::DFad&lt;double&gt;&gt;&amp; ULocal, Table&lt;1, double &gt;&amp; ULocalConv);</div><div class="line">        ParameterHandler* params;       </div><div class="line">};</div></div><!-- fragment --><p> In the overloaded <b>get_residual</b> function, we define the residual for our problem. As our equations are one standrad diffusion equation and Possion equation, we can simiply use the pre-defined model: </p><div class="fragment"><div class="line">this-&gt;ResidualEq.<a class="code" href="class_residual.html#a224462af849f5a1927bc90eb3795f2f2">residualForDiffusionEq</a>(fe_values, c_dof, R, c_1, c_1_conv, j_c_1);</div><div class="line">this-&gt;ResidualEq.<a class="code" href="class_residual.html#af1d58eecf6eeae74de2f7ebc6a158b18">residualForPoissonEq</a>(fe_values, mu_dof, R, kappa_c_1_grad, rhs_mu);</div></div><!-- fragment --><p> fe_values: deal.ii Finite element evaluated in quadrature points of a cell.</p>
<p>c_1_dof, mu_dof: dof index for two primial variables.</p>
<p>R: residual vector of a cell.</p>
<p>c_1: concentration at current time step.</p>
<p>c_1_conv: concentration at the last time step.</p>
<p>j_c_1: flux of the species.</p>
<p>kappa_c_1_grad:left hand side of the Possion equation.</p>
<p>rhs_mu: right hand side of the Possion equation.</p>
<hr/>
<p> The following code deomonstrate how to evaluate the variables defined above. </p><div class="fragment"><div class="line">dealii::Table&lt;1,double&gt;  c_1_conv(n_q_points);</div><div class="line">dealii::Table&lt;1,Sacado::Fad::DFad&lt;double&gt; &gt; c_1(n_q_points), mu(n_q_points);</div><div class="line">dealii::Table&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt;  c_1_grad(n_q_points, dim), mu_grad(n_q_points, dim);</div><div class="line"></div><div class="line">evaluateScalarFunction&lt;double,dim&gt;(fe_values, c_dof, ULocalConv, c_1_conv);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, c_dof, ULocal, c_1);   </div><div class="line">evaluateScalarFunctionGradient&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, c_dof, ULocal, c_1_grad);</div><div class="line"></div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, mu_dof, ULocal, mu);   </div><div class="line">evaluateScalarFunctionGradient&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, mu_dof, ULocal, mu_grad);</div><div class="line"></div><div class="line"><span class="comment">//evaluate diffusion and reaction term</span></div><div class="line">dealii::Table&lt;1,Sacado::Fad::DFad&lt;double&gt; &gt; rhs_mu(n_q_points);</div><div class="line">dealii::Table&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt; j_c_1(n_q_points, dim), kappa_c_1_grad(n_q_points, dim);</div><div class="line"></div><div class="line">j_c_1=table_scaling&lt;Sacado::Fad::DFad&lt;double&gt;, dim&gt;(mu_grad,-M);<span class="comment">//-D_1*c_1_grad</span></div><div class="line">kappa_c_1_grad=table_scaling&lt;Sacado::Fad::DFad&lt;double&gt;, dim&gt;(c_1_grad,kappa);</div><div class="line"></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q=0; q&lt;n_q_points;q++) rhs_mu[q]=2*omega*(c_1[q]-c_alpha)*(c_1[q]-c_beta)*(2*c_1[q]-c_alpha-c_beta)-mu[q];</div></div><!-- fragment --><p>The last thing we need to define is the initial condition, we can simpily overload the <a href="../html/class_initial_conditions.html#aa10cfdd7350c3810a8deab707f397657">vector_value()</a> function of the <a href="../html/class_initial_conditions.html">InitialConditions </a> class, </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="class_initial_conditions.html#aa10cfdd7350c3810a8deab707f397657">InitialConditions&lt;dim&gt;::vector_value</a> (<span class="keyword">const</span> Point&lt;dim&gt;   &amp;p, Vector&lt;double&gt;   &amp;values)<span class="keyword"> const</span>{</div><div class="line">  Assert (values.size() == 2, ExcDimensionMismatch (values.size(), 2));</div><div class="line">  values(1) = 0;    </div><div class="line"> values(0)= 0.5 + 0.04*(static_cast &lt;double&gt; (rand())/(static_cast &lt;double&gt;(RAND_MAX))-0.5);</div><div class="line">}</div><div class="line"></div><div class="line">  The complete implementaion can be found at  &lt;a href=<span class="stringliteral">&quot;https://github.com/mechanoChem/mechanoChemFEM/tree/example/Example2_CahnHilliard&quot;</span>&gt;Github&lt;/a&gt;. </div></div><!-- fragment --><h1><a class="anchor" id="file"></a>
Parameter file: interface for level 2 user</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#parameters file</span></div><div class="line"></div><div class="line">subsection Problem</div><div class="line">set print_parameter = <span class="keyword">true</span></div><div class="line"></div><div class="line">set dt = 5</div><div class="line">set totalTime = 250</div><div class="line">set current_increment = 0</div><div class="line">set off_output_index=0</div><div class="line">set current_time = 0</div><div class="line">set resuming_from_snapshot = <span class="keyword">false</span></div><div class="line"></div><div class="line">set output_directory = output/</div><div class="line">set snapshot_directory = snapshot/</div><div class="line"></div><div class="line"><span class="preprocessor">#FEM</span></div><div class="line">set volume_quadrature = 3 </div><div class="line">set face_quadrature = 2 </div><div class="line"></div><div class="line">end</div><div class="line"></div><div class="line">subsection Geometry</div><div class="line">set X_0 = 0</div><div class="line">set Y_0 = 0</div><div class="line">set Z_0 = 0</div><div class="line">set X_end = 1 </div><div class="line">set Y_end = 1</div><div class="line">set Z_end = 2.0 #no need to 2D</div><div class="line"></div><div class="line">set element_div_x=50</div><div class="line">set element_div_y=50</div><div class="line">set element_div_z=5 #no need to 2D</div><div class="line">end</div><div class="line"></div><div class="line">subsection Concentration</div><div class="line">set omega = 0.25</div><div class="line">set c_alpha = 0.2</div><div class="line">set c_beta = 0.8</div><div class="line">set kappa = 0.002</div><div class="line">set M=0.1</div><div class="line">end</div><div class="line">                        </div><div class="line"><span class="preprocessor">#</span></div><div class="line"><span class="preprocessor"># parameters reserved for deal.ii first level code:</span></div><div class="line"><span class="preprocessor">#nonLinear_method : classicNewton</span></div><div class="line"><span class="preprocessor">#solver_method (direct) : PETScsuperLU, PETScMUMPS</span></div><div class="line"><span class="preprocessor">#solver_method (iterative) : PETScGMRES PETScBoomerAMG</span></div><div class="line"><span class="preprocessor">#relative_norm_tolerance, absolute_norm_tolerance, max_iterations</span></div><div class="line"><span class="preprocessor">#</span></div><div class="line">subsection Nonlinear_solver</div><div class="line">        set nonLinear_method = classicNewton</div><div class="line">        set relative_norm_tolerance = 1.0e-12</div><div class="line">        set absolute_norm_tolerance = 1.0e-12</div><div class="line">        set max_iterations = 10</div><div class="line">end</div><div class="line">                        </div><div class="line">subsection Linear_solver</div><div class="line">        set solver_method = PETScsuperLU</div><div class="line">        set system_matrix_symmetricFlag = <span class="keyword">false</span> # <span class="keywordflow">default</span> is <span class="keyword">false</span></div><div class="line">end</div></div><!-- fragment --><h1><a class="anchor" id="results"></a>
Results</h1>
<p>The results are generated using paramters shown above.</p>
<p> <style>div.image img[src="E2.png"]{width:400px;}</style>  </p><div class="image">
<img src="E2.png" alt="E2.png"/>
</div>
 </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
