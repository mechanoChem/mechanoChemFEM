<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mechanoChemFEM: Example 1 : Turing patterns: diffusion-reaction systems</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mechanoChemFEM
   &#160;<span id="projectnumber">0.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example 1 : Turing patterns: diffusion-reaction systems </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>We solve two diffusion reaction equations: </p><p class="formulaDsp">
\[ \frac{\partial C_\text{1}}{\partial t}+\nabla\cdot\boldsymbol{j}_1=r_1 \\ \frac{\partial C_\text{2}}{\partial t}+\nabla\cdot\boldsymbol{j}_2=r_2 \]
</p>
<p> where \(\boldsymbol{j}_1 \) and \(\boldsymbol{j}_2 \) are flux terms: </p><p class="formulaDsp">
\[ \boldsymbol{j}_1=-M_1\nabla C_\text{1}; \quad \boldsymbol{j}_2=-M_2\nabla C_\text{2}\\ \]
</p>
<p> \(r_1\) and \(r_2\) are reaction terms: </p><p class="formulaDsp">
\[ r_1= R_{10}+R_{11}C_1+R_{13}C_1^2C_2; \quad r_1= R_{20}+R_{21}C_1^2C_2 \]
</p>
<p> The boundary condiiton is </p><p class="formulaDsp">
\[ \boldsymbol{j}_1\cdot\boldsymbol{n}=j_n \text{ on }\Gamma_2;\quad \quad \boldsymbol{j}_1\cdot\boldsymbol{n}=0 \text{ on }\Gamma \backslash \Gamma_2; \quad \quad \boldsymbol{j}_2\cdot\boldsymbol{n}=0 \text{ on }\Gamma \]
</p>
<p> The coupled diffusion-reaction equations for two species follow Schnakenberg kinetics. For an activator-inhibitor species pair, these equations use auto-inhibition with cross-activation of a short range species, and auto-activation with cross-inhibition of a long range species to form so-called Turing patterns.</p>
<h1><a class="anchor" id="imple"></a>
Implementation</h1>
<p>We first define the two scalar primary variables: </p><div class="fragment"><div class="line">std::vector&lt;std::vector&lt;std::string&gt; &gt; primary_variables(2);        </div><div class="line">      primary_variables[0].push_back(<span class="stringliteral">&quot;c1&quot;</span>); primary_variables[0].push_back(<span class="stringliteral">&quot;component_is_scalar&quot;</span>);</div><div class="line">      primary_variables[1].push_back(<span class="stringliteral">&quot;c2&quot;</span>); primary_variables[1].push_back(<span class="stringliteral">&quot;component_is_scalar&quot;</span>);</div></div><!-- fragment --><p> and we solve both species in one domain. We define the domain and basis order for each primal variables: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> number_domain=1;</div><div class="line"><span class="keywordtype">int</span> diff_degree=1;</div><div class="line">std::vector&lt;std::vector&lt;int&gt; &gt; FE_support(number_domain);<span class="comment">// store order of polynomial basis functions, 0 means FE_Nothing   </span></div><div class="line">FE_support[0].push_back(diff_degree);</div><div class="line">FE_support[0].push_back(diff_degree);</div></div><!-- fragment --><p> Before launching the <a href="../html/classinit_bound_val_probs.html">initBoundValProbs</a>, we need to initialize the <b>ParameterHandler</b> and declare all paramters we may use: </p><div class="fragment"><div class="line">ParameterHandler params;</div><div class="line">params.enter_subsection(<span class="stringliteral">&quot;Concentration&quot;</span>);   </div><div class="line">params.declare_entry(<span class="stringliteral">&quot;D_1&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,Patterns::Double() );</div><div class="line">params.declare_entry(<span class="stringliteral">&quot;D_2&quot;</span>,<span class="stringliteral">&quot;0&quot;</span>,Patterns::Double() );</div><div class="line"><span class="comment">//... more parameters </span></div><div class="line">params.leave_subsection();  </div></div><!-- fragment --><p> Now we just need to have class inherited from <a href="../html/classinit_bound_val_probs.html">initBoundValProbs</a> class, and overload the <a href="../html/classinit_bound_val_probs.html#ac8f2c3e2a1040c70b709900dc3dfdaea">get_residual()</a> function: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keyword">class </span>diffusion_reaction: <span class="keyword">public</span> <a class="code" href="classinit_bound_val_probs.html">initBoundValProbs</a>&lt;dim&gt;</div><div class="line">{</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        diffusion_reaction(std::vector&lt;std::vector&lt;std::string&gt; &gt; _primary_variables, std::vector&lt;std::vector&lt;int&gt; &gt; _FE_support, ParameterHandler&amp; _params);</div><div class="line">        <span class="comment">//this is a overloaded function </span></div><div class="line">        <span class="keywordtype">void</span> <a class="code" href="classinit_bound_val_probs.html#ac8f2c3e2a1040c70b709900dc3dfdaea">get_residual</a>(<span class="keyword">const</span> <span class="keyword">typename</span> hp::DoFHandler&lt;dim&gt;::active_cell_iterator &amp;cell, <span class="keyword">const</span> FEValues&lt;dim&gt;&amp; fe_values, Table&lt;1, Sacado::Fad::DFad&lt;double&gt; &gt;&amp; R, Table&lt;1, Sacado::Fad::DFad&lt;double&gt;&gt;&amp; ULocal, Table&lt;1, double &gt;&amp; ULocalConv);</div><div class="line">        ParameterHandler* <a class="code" href="classinit_bound_val_probs.html#a31d5e7a5228d9d55ba00fae854fcfaa0">params</a>;       </div><div class="line">};</div></div><!-- fragment --><p> In the overloaded <b>get_residual</b> function, we define the residual for our problem. As our equations are standrad diffusion-reaction, we can simiply use the pre-defined model: </p><div class="fragment"><div class="line">this-&gt;ResidualEq.<a class="code" href="class_residual.html#a144663fb81fc60d4db0c5a8e45176e61">residualForDiff_ReacEq</a>(fe_values, c_1_dof, R, c_1, c_1_conv, j_c_1, reaction_1);</div><div class="line">this-&gt;ResidualEq.<a class="code" href="class_residual.html#a144663fb81fc60d4db0c5a8e45176e61">residualForDiff_ReacEq</a>(fe_values, c_2_dof, R, c_2, c_2_conv, j_c_2, reaction_2);</div></div><!-- fragment --><p> Though before we call these two functions, we need the flux and reactions terms, we need to first evaluate the values of the primary fields and their spatial gradients. We also need to evaluate the value of primary fields at previous time step for the Backward Euler time scheme: </p><div class="fragment"><div class="line">dealii::Table&lt;1,double&gt;  c_1_conv(n_q_points), c_2_conv(n_q_points);</div><div class="line">dealii::Table&lt;1,Sacado::Fad::DFad&lt;double&gt; &gt; c_1(n_q_points), c_2(n_q_points);</div><div class="line">dealii::Table&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt;  c_1_grad(n_q_points, dim), c_2_grad(n_q_points, dim);</div><div class="line"></div><div class="line">evaluateScalarFunction&lt;double,dim&gt;(fe_values, c_1_dof, ULocalConv, c_1_conv);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, c_1_dof, ULocal, c_1); </div><div class="line">evaluateScalarFunctionGradient&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, c_1_dof, ULocal, c_1_grad);</div><div class="line"></div><div class="line">evaluateScalarFunction&lt;double,dim&gt;(fe_values, c_2_dof, ULocalConv, c_2_conv);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, c_2_dof, ULocal, c_2); </div><div class="line">evaluateScalarFunctionGradient&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(fe_values, c_2_dof, ULocal, c_2_grad);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//evaluate diffusion and reaction term</span></div><div class="line">dealii::Table&lt;1,Sacado::Fad::DFad&lt;double&gt; &gt; reaction_1(n_q_points), reaction_2(n_q_points);</div><div class="line">dealii::Table&lt;2,Sacado::Fad::DFad&lt;double&gt; &gt; j_c_1(n_q_points, dim),j_c_2(n_q_points, dim);</div><div class="line"></div><div class="line">j_c_1=table_scaling&lt;Sacado::Fad::DFad&lt;double&gt;, dim&gt;(c_1_grad,-D_1);<span class="comment">//-D_1*c_1_grad</span></div><div class="line">j_c_2=table_scaling&lt;Sacado::Fad::DFad&lt;double&gt;, dim&gt;(c_2_grad,-D_2);<span class="comment">//-D_2*c_2_grad</span></div><div class="line"></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> q=0; q&lt;n_q_points;q++){</div><div class="line">    reaction_1[q]=R_10+R_11*c_1[q]+R_12*c_2[q]+R_13*c_1[q]*c_1[q]*c_2[q];</div><div class="line">    reaction_2[q]=R_20+R_21*c_1[q]+R_22*c_2[q]+R_23*c_1[q]*c_1[q]*c_2[q];</div><div class="line">}</div></div><!-- fragment --><p> Besides the residual for the PDEs, we have the boundary conditions on one surface: </p><div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> faceID=0; faceID&lt;2*dim; faceID++){</div><div class="line">    <span class="keywordflow">if</span>(cell-&gt;face(faceID)-&gt;boundary_id()==dim*2 ){</div><div class="line">      FEFaceValues&lt;dim&gt; fe_face_values(fe_values.get_fe(), *(this-&gt;common_face_quadrature), update_values | update_quadrature_points | update_JxW_values);</div><div class="line">        fe_face_values.reinit(cell,faceID);</div><div class="line">        this-&gt;ResidualEq.<a class="code" href="class_residual.html#a4c8fd158c8034b25780abfe785755baa">residualForNeummanBC</a>(fe_values, fe_face_values, c_1_dof, R, jn);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p> The last thing we need to define is the initial condition, we can simpily overload the <a href="../html/class_initial_conditions.html#aa10cfdd7350c3810a8deab707f397657">vector_value()</a> function of the <a href="../html/class_initial_conditions.html">InitialConditions </a> class, </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="class_initial_conditions.html#aa10cfdd7350c3810a8deab707f397657">InitialConditions&lt;dim&gt;::vector_value</a> (<span class="keyword">const</span> Point&lt;dim&gt;   &amp;p, Vector&lt;double&gt;   &amp;values)<span class="keyword"> const</span>{</div><div class="line">  Assert (values.size() == 2, ExcDimensionMismatch (values.size(), 2));</div><div class="line">  values(1) = 0;    </div><div class="line">  values(0)= 0.5 + 0.1*static_cast &lt;double&gt; (rand())/(static_cast &lt;double&gt;(RAND_MAX/2.0))/2;</div><div class="line">}</div></div><!-- fragment --> <h1><a class="anchor" id="results"></a>
Results</h1>
<p>The right plot shows the patterns of the Schnakenberg kinetics.  <style>div.image img[src="E1.png"]{width:400px;}</style>  </p><div class="image">
<img src="E1.png" alt="E1.png"/>
</div>
<p>The results are generated using paramters shown below. The complete implementaion can be found at <a href="https://github.com/mechanoChem/mechanoChemFEM/tree/example/Example1_diffusion_eaction">Github</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#parameters file</span></div><div class="line"></div><div class="line">subsection Problem</div><div class="line">set print_parameter = <span class="keyword">true</span></div><div class="line"></div><div class="line">set dt = 1</div><div class="line">set totalTime = 50</div><div class="line">set current_increment = 0</div><div class="line">set off_output_index=0</div><div class="line">set current_time = 0</div><div class="line">set resuming_from_snapshot = <span class="keyword">false</span></div><div class="line"></div><div class="line">set output_directory = output/</div><div class="line">set snapshot_directory = snapshot/</div><div class="line"></div><div class="line"><span class="preprocessor">#FEM</span></div><div class="line">set volume_quadrature = 3 </div><div class="line">set face_quadrature = 2 </div><div class="line">end</div><div class="line"></div><div class="line">subsection Geometry</div><div class="line">set X_0 = 0</div><div class="line">set Y_0 = 0</div><div class="line">set Z_0 = 0</div><div class="line">set X_end = 10</div><div class="line">set Y_end = 10</div><div class="line">set Z_end = 2.0 #no need to 2D</div><div class="line"></div><div class="line">set element_div_x=50</div><div class="line">set element_div_y=50</div><div class="line">set element_div_z=5 #no need to 2D</div><div class="line">end</div><div class="line"></div><div class="line">subsection Concentration</div><div class="line"></div><div class="line">set D_1 = 0.1</div><div class="line">set D_2 = 4.0</div><div class="line">set R_10 = 0.1</div><div class="line">set R_11 = -1</div><div class="line">set R_13 = 1</div><div class="line">set R_20 = 0.9</div><div class="line">set R_21 = 0</div><div class="line">set R_23 = -1</div><div class="line">set jn=-0.01</div><div class="line">end</div><div class="line">                        </div><div class="line"><span class="preprocessor">#</span></div><div class="line"><span class="preprocessor"># parameters reserved for deal.ii first level code:</span></div><div class="line"><span class="preprocessor">#nonLinear_method : classicNewton</span></div><div class="line"><span class="preprocessor">#solver_method (direct) : PETScsuperLU, PETScMUMPS</span></div><div class="line"><span class="preprocessor">#solver_method (iterative) : PETScGMRES PETScBoomerAMG</span></div><div class="line"><span class="preprocessor">#relative_norm_tolerance, absolute_norm_tolerance, max_iterations</span></div><div class="line"><span class="preprocessor">#</span></div><div class="line">subsection Nonlinear_solver</div><div class="line">        set nonLinear_method = classicNewton</div><div class="line">        set relative_norm_tolerance = 1.0e-12</div><div class="line">        set absolute_norm_tolerance = 1.0e-12</div><div class="line">        set max_iterations = 20</div><div class="line">end</div><div class="line">                        </div><div class="line">subsection Linear_solver</div><div class="line">        set solver_method = PETScsuperLU</div><div class="line">        set system_matrix_symmetricFlag = <span class="keyword">false</span> # <span class="keywordflow">default</span> is <span class="keyword">false</span></div><div class="line">end</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
