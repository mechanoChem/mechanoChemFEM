<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mechanoChemFEM: Example 3 : Battery model at particle scale</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mechanoChemFEM
   &#160;<span id="projectnumber">0.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Example 3 : Battery model at particle scale </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>A battery cell consists of porous, positive and negative electrodes, a separator and current collectors(see Figure 1). The electrode consists of active-material particles and carbon-binders, and the porespace is filled with the electrolyte. The two electrodes are isolated by a separator which is usuallymade of polyolefin for Li-ion batteries. The porous separator is perfused with electrolyte, allowingionic transport between the electrodes. Metallic current collectors are located at either end of the battery.</p>
<p>This example present a coupled continuum formulation for the electrostatic, chemical, thermal, mechanical and fluid physics in battery materials. The treatment is at the particle scale, at whic hthe active particles held together by binders, the porous separator, current collectors and the perfusing electrolyte are explicitly modeled.</p>
<p>This code is used to generate results for paper: <b>A multi-physics battery model with particle scale resolution ofporosity evolution driven by intercalation strain and electrolyte flow</b>, Z. Wang, K. Garikipati, arXiv:1804.06436  <style>div.image img[src="domain_binder.png"]{width:700px;}</style>  </p><div class="image">
<img src="domain_binder.png" alt="domain_binder.png"/>
<div class="caption">
A schematic showing each component of a battery cell. The entire battery cell is a rolled or folded structure of a layer.</div></div>
<h2><a class="anchor" id="section1"></a>
The coupled electro-chemo-thermo-mechanical model</h2>
<p>We lay down the governing equations for primary variables in three dimensions. As is the convention in continuum mechanics, the solids (current collector,active-material particle and polymeric separator particles) are described in a Lagrangian setting, while the fluid (electrolyte) flow is described in an Eulerian setting. Electrolytic flow around thedeforming solid components alters the fluid domain. The fluid mesh therefore must be remapped asthe computation proceeds. The Arbitrary Lagrangian-Eulerian (ALE) framework is adopted herefor this purpose. </p>
<h3><a class="anchor" id="subsub1"></a>
Electro-chemo-thermal equations</h3>
<p>In the active material we have conservation of lithium: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial C_\text{Li}}{\partial t}+\nabla\cdot\boldsymbol{j}=0\\ \boldsymbol{j}=-D\nabla C_\text{Li} \]" src="form_40.png"/>
</p>
<p> where <img class="formulaInl" alt="$D$" src="form_41.png"/> is diffusivity. Conservation of of Li <img class="formulaInl" alt="$^+$" src="form_42.png"/> cations in the electrolyte is written similarly: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{\partial C_{\text{Li}^+}}{\partial t}+\nabla\cdot\boldsymbol{j}_+=0 \]" src="form_43.png"/>
</p>
<p> In general, the flux of each species can depend on the concentration gradients of the other species. This is a special case of the Onsager reciprocity relations with the dependence on chemical potential gradients reduced to concentration gradient dependence. Following Newman and Thomas-Alyea <img class="formulaInl" alt="$^{\text{J. Newman and K. E. Thomas-Alyea,John Wiley and Sons, Inc, (2004).}}$" src="form_44.png"/>, we have </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{j}_+=-D_{+}\nabla C_{\text{Li}^+} +\frac{t_+}{F}\boldsymbol{i}_\text{E}+C_{\text{Li}^+}\boldsymbol{v} \]" src="form_45.png"/>
</p>
<p> for a binary solution. Here, <img class="formulaInl" alt="$D_{+}$" src="form_46.png"/> is the diffusivity, <img class="formulaInl" alt="$t_+$" src="form_47.png"/> is the transference number of the cation, <img class="formulaInl" alt="$\boldsymbol{v}$" src="form_48.png"/> is the electrolyte velocity, <img class="formulaInl" alt="$F$" src="form_49.png"/> is the Faraday constant, and <img class="formulaInl" alt="$\boldsymbol{i}_\text{E}$" src="form_50.png"/> is the total current in the electrolyte phase which will be derived in what follows.</p>
<p>The total current in the current collector and active material is governed by Ohm's law: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{i}_\text{S}=-\sigma_\text{S} \nabla\phi_\text{S} \]" src="form_51.png"/>
</p>
<p> where <img class="formulaInl" alt="$\phi_\text{S}$" src="form_14.png"/> is the electric potential, and the conductivity <img class="formulaInl" alt="$\sigma_\text{S}$" src="form_52.png"/> differs between the current collector and active material. In the electrolyte we have </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{i}_\text{E}=-\sigma_\text{E}\nabla\phi_\text{E}-\gamma_\text{D}\nabla\ln C_{\text{Li}^+} \]" src="form_53.png"/>
</p>
<p> where <img class="formulaInl" alt="$\sigma_\text{E}$" src="form_54.png"/> is the electrolyte's conductivity, and <img class="formulaInl" alt="$\gamma_\text{D}$" src="form_55.png"/> is the diffusion conductivity evaluated as: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \gamma_\text{D}=\frac{2R\theta \sigma_\text{E}}{F}\left(1-t_+\right)\left(1+\frac{d \ln f}{d\ln C_{\text{Li}^+}}\right), \]" src="form_56.png"/>
</p>
<p> with <img class="formulaInl" alt="$f$" src="form_57.png"/> being the mean molar activity coefficient of the electrolyte, which is assumed to be constant. Thus the relation simplifies to </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \gamma_\text{D}=\frac{2 R\theta \sigma_\text{E}}{F}\left(1-t_+\right). \]" src="form_58.png"/>
</p>
<p> Under the electroneutrality approximation, we have </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla\cdot (- \sigma_\text{s}\nabla\phi_\text{S})=0 \]" src="form_59.png"/>
</p>
<p> in the active material, and </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla\cdot\left(-\sigma_\text{E}\nabla\phi_\text{E}-\gamma_\text{D}\nabla\ln C_{\text{Li}^+}\right)=0 \]" src="form_60.png"/>
</p>
<p> in the electrolyte. These two equations properly describe the electric potentials with the electroneutrality approximation, such that the double layer effect is neglected.</p>
<h2><a class="anchor" id="section2"></a>
The standard thermal equations</h2>
<p>Heat generation and transport are governed by the heat equation, which is derived from the first law of thermodynamics. Since the velocity of the electrolyte is low, with a Peclet number Pe <img class="formulaInl" alt="$\sim 1.0\times 10^{-7}$" src="form_61.png"/>, we neglect heat flux by advection. For the temperature <img class="formulaInl" alt="$\theta$" src="form_18.png"/>, we have the standard form of the heat equation: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho C_p\frac{\text{d}\theta}{\text{d}t}+\nabla \cdot\boldsymbol{q}=0 \]" src="form_62.png"/>
</p>
<p> where <img class="formulaInl" alt="$\rho$" src="form_25.png"/> is the mass density of the electrode, <img class="formulaInl" alt="$C_p$" src="form_26.png"/> is the specific heat and <img class="formulaInl" alt="$\boldsymbol{q}$" src="form_63.png"/> is the heat flux. The heat flux can be expressed as </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{q}=\phi F\sum_i z_i\boldsymbol{j}_i-\lambda\nabla\theta+\boldsymbol{q}^\text{D} \]" src="form_64.png"/>
</p>
<p> where <img class="formulaInl" alt="$\lambda$" src="form_27.png"/> is the thermal conductivity. The first term on right is associated with Joule heating and the last term <img class="formulaInl" alt="$\boldsymbol{q}^\text{D}$" src="form_65.png"/> is the Dufour effect, which is ignored in this work. Again, with the electroneutrality approximation we have $\nabla\cdot\sum z_i \boldsymbol{j}_i=0$, we have </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho C_p\frac{\text{d}\theta}{\text{d}t}-\lambda \nabla^2\theta+\nabla\phi_\text{S}\cdot\boldsymbol{i}_\text{S}=0 \]" src="form_66.png"/>
</p>
<p> in the electrode, and </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \rho C_p\frac{\text{d}\theta}{\text{d}t}-\lambda \nabla^2\theta+\nabla\phi_\text{E}\cdot\boldsymbol{i}_\text{E}=0 \]" src="form_67.png"/>
</p>
<p> in the electrolyte.</p>
<h2><a class="anchor" id="section3"></a>
Finite strain mechanics</h2>
<p>Lithium intercalation and de-intercalation induce expansion and contraction, respectively, of the active material. Additionally, the active material, binder, porous separator and current collector undergo thermal expansion. The kinematics of finite strain leads to the following decomposition in the active material: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{F}=\boldsymbol{F}^\text{e}\boldsymbol{F}^\text{c}\boldsymbol{F}^{\theta}. \]" src="form_68.png"/>
</p>
<p> For other solid sub-domains (binder and polymeric separator particles) we have </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{F}=\boldsymbol{F}^\text{e}\boldsymbol{F}^{\theta}. \]" src="form_69.png"/>
</p>
<p> Here, <img class="formulaInl" alt="$\boldsymbol{F} = \boldsymbol{I} + \partial\boldsymbol{u}/\partial\boldsymbol{X}$" src="form_70.png"/>, is the total deformation gradient tensor in each of the relevant solid regions. Its multiplicative components <img class="formulaInl" alt="$\boldsymbol{F}^\text{e}$" src="form_32.png"/>, <img class="formulaInl" alt="$\boldsymbol{F}^\text{c}$" src="form_33.png"/> and <img class="formulaInl" alt="$\boldsymbol{F}^{\theta}$" src="form_34.png"/>, are, respectively, the elastic, chemical (induced by lithium intercalation) and thermal components. In the absence of a body force the strong form of the mechanics problem in the current configuration is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla\cdot\boldsymbol{T} = \boldsymbol{0}, \]" src="form_71.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \text{for}\quad \boldsymbol{T}= \frac{1}{\det{\boldsymbol{F}^\text{e}}}\frac{\partial W}{\partial \boldsymbol{F}^\text{e}}\boldsymbol{F}^{\text{e}^\text{T}}, \]" src="form_72.png"/>
</p>
<p> where <img class="formulaInl" alt="$\boldsymbol{T}$" src="form_73.png"/> is the Cauchy stress tensor and <img class="formulaInl" alt="$W$" src="form_74.png"/> is the strain energy density function. The chemical and thermal expansion components of the multiplicative decomposition of <img class="formulaInl" alt="$\boldsymbol{F}$" src="form_75.png"/> are modelled as isotropic, e.g.: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ F^{\text{c}}_{iJ}=(1+\beta^{\text{c}})^{1/3}\delta_{iJ} \\ F^{\theta}_{iJ}=(1+\beta^{\theta})^{1/3}\delta_{iJ} \]" src="form_76.png"/>
</p>
<p> The lithiation swelling response function is parameterized by the lithium concentration. We write </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \beta^{\theta}(\theta)=\Omega_{\theta} (\theta-\theta_0) \]" src="form_77.png"/>
</p>
<p> for the thermal expansion functions.</p>
<h2><a class="anchor" id="section4"></a>
Incompressible fluid model</h2>
<p>We model the electrolyte as an incompressible, creeping flow. In this regime, with inertia and body forces being neglected, the Stokes equations are: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ -2\eta\nabla\cdot\varepsilon(\boldsymbol{v})+\nabla p=0 \]" src="form_78.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla\cdot\boldsymbol{v}=0 \]" src="form_79.png"/>
</p>
<p> where <img class="formulaInl" alt="$\varepsilon(\boldsymbol{v})=\frac{1}{2}(\nabla\boldsymbol{v}+\nabla\boldsymbol{v}^\text{T})$" src="form_80.png"/> is the strain rate tensor, and <img class="formulaInl" alt="$\eta$" src="form_81.png"/> is the dynamic viscosity.</p>
<h2><a class="anchor" id="section5"></a>
The Arbitrary Lagrangian-Eulerian framework</h2>
<p>In the fluid (electrolyte) phase, whose description is Eulerian, the mesh must be mapped to evolve with the fluid sub-domain as it flows around the deforming solid components. If the mesh displacement is <img class="formulaInl" alt="$\boldsymbol{u}_\text{m}$" src="form_82.png"/>, the spatial gradient operator acting on a variable <img class="formulaInl" alt="$\tau$" src="form_83.png"/> in the Eulerian setting is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla \tau=\frac{\partial\tau}{\partial\boldsymbol{X}}\boldsymbol{F}_\text{m}^{-1} \]" src="form_84.png"/>
</p>
<p> where <img class="formulaInl" alt="$\boldsymbol{F}_\text{m}= \boldsymbol{I} +\partial \boldsymbol{u}_\text{m}/\partial \boldsymbol{X}$" src="form_85.png"/>, is the deformation gradient tensor of the mesh. In the solid phase, <img class="formulaInl" alt="$\boldsymbol{u}_\text{m}$" src="form_82.png"/> coincides with the displacement of material points, <img class="formulaInl" alt="$\boldsymbol{u}$" src="form_86.png"/>, and <img class="formulaInl" alt="$\boldsymbol{F}_\text{m}$" src="form_87.png"/> is replaced by the deformation gradient tensor of the solid, <img class="formulaInl" alt="$\boldsymbol{F}$" src="form_75.png"/>. In the fluid phase the description of fluid mesh deformation could be arbitrary, but its choice proves to be critical in solid-fluid interaction problems. The mesh displacement in the fluid phase can be solved by Poisson equations, arbitrary elasticity equations or bi-harmonic equations.</p>
<p>The large lithium intercalation strain may lead to a dramatic volume change of the active material. The large deformation of active material may cause extreme distortions of the mesh in the fluid. For this reason, we apply adaptive mesh rezoning schemes. The idea is to introduce a constraint condition over two adjacent element nodes <img class="formulaInl" alt="$i$" src="form_88.png"/> and <img class="formulaInl" alt="$j$" src="form_89.png"/> such that the relative difference of net displacements is less than the element length <img class="formulaInl" alt="$h^e$" src="form_90.png"/>: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ |\boldsymbol{u}_m^i-\boldsymbol{u}_m^j|\le\alpha h^e, \]" src="form_91.png"/>
</p>
<p> which is equivalent to </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ |\nabla\boldsymbol{u}_m|\le\alpha \]" src="form_92.png"/>
</p>
<p> where <img class="formulaInl" alt="$\alpha\in[0,1)$" src="form_93.png"/> is the tolerance for element distortion. This constraint is applied element wise as a penalty term: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \nabla^2(1+\tau_m\boldsymbol{u}_m)=\boldsymbol{0} \]" src="form_94.png"/>
</p>
<p> where <img class="formulaInl" alt="$\tau_m$" src="form_95.png"/> is the weight function that imposes spatially varying stiffening effects for the mesh. The key idea for choosing <img class="formulaInl" alt="$\tau_m$" src="form_95.png"/> is to enforce this value to be high for smaller elements and small for large elements. In this work we choose </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tau_m=\left(\frac{\det \boldsymbol{F}_m^0}{\det \boldsymbol{F}_m} \right)^\delta \]" src="form_96.png"/>
</p>
<p> where <img class="formulaInl" alt="$\boldsymbol{F}_m^0$" src="form_97.png"/> is the initial deformation gradient tensor of the mesh and <img class="formulaInl" alt="$\delta$" src="form_98.png"/> is a constant value.</p>
<h2><a class="anchor" id="subsection3"></a>
Boundary and interface condition</h2>
<p>The multi-physics character of this problem extends to the restriction of certain physics&ndash;and therefore the corresponding partial differential equations&ndash;to specific sub-domains. The conventional application of boundary conditions translates to interface conditions where the sub-domains meet. During discharging or charging, the following chemical reactions occur at the interface between the active material and electrolyte: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \text{Li}\to \text{Li}^++q^-, \quad \text{-ve electrode during discharge/+ve electrode during charge,}\nonumber\\ \text{Li}^++q^- \to\text{Li},\quad \text{+ve electrode during discharge/-ve electrode during charge}.\nonumber \]" src="form_99.png"/>
</p>
<p> The reaction rate is given by the Butler-Volmer model </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ j_n=j_0\left(\text{exp}\left(\frac{\alpha_aF}{R\theta}(\phi_\text{S}-\phi_\text{E}-U)\right)-\text{exp}\left(-\frac{\alpha_aF}{R\theta}(\phi_\text{S}-\phi_\text{E}-U)\right)\right) \label{eq:BVeuqation}\\ j_0=k_0(C_{\text{Li}^+})^{\alpha_a} \frac{(C_\text{Li}^{\text{max}}-C_\text{Li})^{\alpha_a}}{(C_1^{\text{max}})^{\alpha_a}} \frac{(C_\text{Li})^{\alpha_c}}{{(C_1^\text{max}})^{\alpha_c}} \]" src="form_100.png"/>
</p>
<p> where <img class="formulaInl" alt="$\alpha_a, \alpha_c$" src="form_20.png"/> are transfer coefficients and <img class="formulaInl" alt="$k_0$" src="form_21.png"/> is a kinetic rate constant. The interface condition for lithium and lithium ions: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{j}\cdot \boldsymbol{n}_\text{s}=j_n \quad \text{on } \Gamma_\text{s-e},\\ \boldsymbol{j}_+\cdot \boldsymbol{n}_\text{e}=-j_n\ \quad \text{on } \Gamma_\text{s-e}, \]" src="form_101.png"/>
</p>
<p> The interface condition for the electric potential: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{i}_\text{S}\cdot\boldsymbol{n}_\text{s}=Fj_n \quad \text{on } \Gamma_\text{s-e}\\ \boldsymbol{i}_\text{E}\cdot\boldsymbol{n}_\text{e}=-Fj_n \ \quad \text{on } \Gamma_\text{s-e} \]" src="form_102.png"/>
</p>
<p> At the interface, the chemical reactions also generate heat: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q_{\Gamma_\text{s-e}}=q_{\text{rxn}}+q_{\text{rev}} \]" src="form_103.png"/>
</p>
<p> where </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ q_{\text{rxn}}=Fj_n(\phi_\text{S}-\phi_\text{E}-U) ;\quad \text{irreversible entropic heat,} \\ q_{\text{rev}}=Fj_n\theta\frac{\partial U}{\partial \theta};\quad\text{reversible entropic heat.} \]" src="form_104.png"/>
</p>
<p> The electrolytic fluid is bounded within the solid materials: active material, binder, polymeric separator particles, and current collector. No-slip conditions give </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{v}=\dot{\boldsymbol{u}} \quad \text{on } \Gamma_\text{s-e}, \Gamma_\text{e-c}, \Gamma_\text{e-p} \]" src="form_105.png"/>
</p>
<p> Traction continuity on all solid-fluid interfaces gives: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{T}\boldsymbol{n}_\text{s}=-(2\eta\cdot\varepsilon(\boldsymbol{v})-p\boldsymbol{1})\boldsymbol{n}_\text{e} \quad \text{on } \Gamma_\text{s-e} \\ \boldsymbol{T}\boldsymbol{n}_\text{c}=-(2\eta\cdot\varepsilon(\boldsymbol{v})-p\boldsymbol{1})\boldsymbol{n}_\text{e} \quad \text{on } \Gamma_\text{e-c} \\ \boldsymbol{T}\boldsymbol{n}_\text{p}=-(2\eta\cdot\varepsilon(\boldsymbol{v})-p\boldsymbol{1})\boldsymbol{n}_\text{e} \quad \text{on } \Gamma_\text{e-p} \]" src="form_106.png"/>
</p>
<p> Compatibility at the solid-fliud interfaces equates the ALE mesh deformation, <img class="formulaInl" alt="$\boldsymbol{u}_\text{m}$" src="form_82.png"/> in the electrolyte sub-domain to the solid deformations: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \boldsymbol{u}_\text{m}=\boldsymbol{u} \quad \text{on } \Gamma_\text{s-e}, \Gamma_\text{c-e}, \Gamma_\text{p-e}. \]" src="form_107.png"/>
</p>
<p>  <style>div.image img[src="boundaryCondition.png"]{width:500px;}</style>  </p><div class="image">
<img src="boundaryCondition.png" alt="boundaryCondition.png"/>
<div class="caption">
A schematic showing boundary and interface conditions.</div></div>
<h1><a class="anchor" id="Implementation"></a>
Implementation</h1>
<p>The code is very similar to <a class="el" href="battery_electrode_scale.html">Example 2 : Battery model at electrode scale</a>. Here we mainly discuss how to apply interface condition and apply constraints during solve step.</p>
<p><b>Applying boundary and interface conditions</b><br />
 During updating linear system, we apply these boundary and interface conditions discussed above. For interface coditions, we first need to find these interface. For example to find interface bewteen active_material and electrolyte we can loop the element face and check the domain id of elements on both sides. </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(cell-&gt;material_id()==active_material_id  ){</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> f=0; f&lt;GeometryInfo&lt;dim&gt;::faces_per_cell; ++f){</div><div class="line">        <span class="keywordflow">if</span> (cell-&gt;at_boundary(f) == <span class="keyword">false</span>){</div><div class="line">            <span class="keywordflow">if</span>(cell-&gt;neighbor(f)-&gt;material_id()==electrolyte_id  and cell-&gt;neighbor(f)-&gt;has_children() == <span class="keyword">false</span>){</div><div class="line">              assemble_interface_activeMaterial_electrolyte_term(cell, f, ULocal, ULocalConv, localized_U, R);                                          </div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cell-&gt;neighbor(f)-&gt;has_children() == <span class="keyword">true</span>){</div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sf=0; sf&lt;cell-&gt;face(f)-&gt;n_children(); ++sf){</div><div class="line">                    <span class="keywordflow">if</span> (cell-&gt;neighbor_child_on_subface(f, sf)-&gt;material_id()==electrolyte_id ){</div><div class="line">                      assemble_interface_activeMaterial_electrolyte_term(cell, f, ULocal, ULocalConv, localized_U, R);                                                                </div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p> Once we find the interface, the corresponding function for assemble interfacial residual is called. Now let's take a look of one of these functions. The following code iitialize the finite elemnt system for the elements on both sides and their faces. </p><div class="fragment"><div class="line">  hp::FEValues&lt;dim&gt; hp_fe_values (fe_collection, q_collection, update_values | update_quadrature_points  | update_JxW_values | update_gradients);</div><div class="line">FEFaceValues&lt;dim&gt; activeMaterial_fe_face_values (*fe_system[active_material_fe], *common_face_quadrature, update_values | update_quadrature_points | update_JxW_values | update_normal_vectors | update_gradients);</div><div class="line">FEFaceValues&lt;dim&gt; electrolyte_fe_face_values (*fe_system[electrolyte_fe], *common_face_quadrature, update_values | update_quadrature_points | update_JxW_values | update_normal_vectors | update_gradients); </div><div class="line">  </div><div class="line">  hp_fe_values.reinit (cell);</div><div class="line">  <span class="keyword">const</span> FEValues&lt;dim&gt; &amp;activeMaterial_fe_values = hp_fe_values.get_present_fe_values();</div><div class="line">  hp_fe_values.reinit (cell-&gt;neighbor(f));</div><div class="line">  <span class="keyword">const</span> FEValues&lt;dim&gt; &amp;electrolyte_fe_values = hp_fe_values.get_present_fe_values();</div><div class="line">  activeMaterial_fe_face_values.reinit(cell, f);</div><div class="line">  electrolyte_fe_face_values.reinit(cell-&gt;neighbor(f), cell-&gt;neighbor_of_neighbor(f));</div><div class="line">  std::vector&lt;types::global_dof_index&gt; activeMaterial_neighbor_dof_indices (electrolyte_dofs_per_cell);</div></div><!-- fragment --><p> Then we can evaluate all fields at surface quadrature points using <a class="el" href="group___evaluation_functions.html#ga2e2fbeb2173113c6889c73bbb7304789">evaluate functions </a> </p><div class="fragment"><div class="line">evaluateVectorFunctionGradient&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(electrolyte_fe_values, electrolyte_fe_face_values, v_dof, ULocal_electrolyte, velocity_grad,defMap_mesh_surface);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(electrolyte_fe_values, electrolyte_fe_face_values, p_dof, ULocal_electrolyte, Pressure);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(electrolyte_fe_values, electrolyte_fe_face_values, c_li_plus_dof, ULocal_electrolyte, c_li_plus);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(electrolyte_fe_values, electrolyte_fe_face_values, phi_e_dof, ULocal_electrolyte, phi_e);</div><div class="line"></div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(activeMaterial_fe_values, activeMaterial_fe_face_values, T_dof, ULocal, T);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(activeMaterial_fe_values, activeMaterial_fe_face_values, c_li_dof, ULocal, c_li);</div><div class="line">evaluateScalarFunction&lt;Sacado::Fad::DFad&lt;double&gt;,dim&gt;(activeMaterial_fe_values, activeMaterial_fe_face_values, phi_s_dof, ULocal, phi_s);</div></div><!-- fragment --><p> These interface conditions are Neumman conditions. And the residual is assembled by calling the residual functions as we discuss before.</p>
<p><b>Applying constraints during solve step</b><br />
 The interface condition <img class="formulaInl" alt="$\boldsymbol{u}_\text{m}=\boldsymbol{u}$" src="form_108.png"/> is a master-slave interface, meanning <img class="formulaInl" alt="$\boldsymbol{u}_\text{m}$" src="form_82.png"/> does not affect <img class="formulaInl" alt="$\boldsymbol{u}$" src="form_86.png"/> but just take its value as a Dirichlet boundary condition. So we cannot use the constraint materix to apply this constraint. Here we apply this constrain manually during the solve step. First we need to find the pair of DOFs for <img class="formulaInl" alt="$\boldsymbol{u}$" src="form_86.png"/> and <img class="formulaInl" alt="$\boldsymbol{u}_\text{m}$" src="form_82.png"/> at same node. And save it as constrain_index. </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (ck1&gt;=0 &amp;&amp; ck1&lt;dim ){</div><div class="line">        <span class="keywordtype">int</span> dof_per_node=local_face_dof_indices2.size()/4;</div><div class="line">        <a class="code" href="classhp_f_e_m.html">hpFEM&lt;dim&gt;::constraints</a>.add_line (local_face_dof_indices1[i]);<span class="comment">//u_mesh                                                      </span></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=(node_u_m_applied/2)*dof_per_node; j&lt;local_face_dof_indices2.size(); ++j){</div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ck3 = fe_system[current_collector_fe]-&gt;face_system_to_component_index(j).first;</div><div class="line">            <span class="keywordflow">if</span>(ck3==ck1){</div><div class="line">                constrain_index[0].push_back(local_face_dof_indices1[i]);</div><div class="line">                constrain_index[1].push_back(local_face_dof_indices2[j]);</div><div class="line">                node_u_m_applied++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }                       </div><div class="line">    }   </div></div><!-- fragment --><p> This constraint is equivalent to <img class="formulaInl" alt="$d\boldsymbol{u}_\text{m}=d\boldsymbol{u}$" src="form_109.png"/> which can be applied during the nonlinear solve step. We only need to overload function <a class="el" href="classsolve_class.html#a029ece57f667fa697cb29eb482eff31b">apply_dU_constrain </a>. </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> dim&gt;</div><div class="line"><span class="keywordtype">void</span> <a class="code" href="classsolve_class.html#a029ece57f667fa697cb29eb482eff31b">initBoundValProbs&lt;dim&gt;::apply_dU_constrain</a>(PETScWrappers::MPI::Vector&amp; dU)</div><div class="line">{</div><div class="line">    PETScWrappers::Vector localized_dU(this-&gt;dU);   </div><div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;constrain_index[0].size();i++){</div><div class="line">        localized_dU(constrain_index[0][i])=localized_dU(constrain_index[1][i]);</div><div class="line">    }</div><div class="line">    dU = localized_dU;</div><div class="line">}</div></div><!-- fragment --><p> Also use another <a class="el" href="">nonlinear solver function </a> which take a extra argument <b>vectorType&amp; dU</b>.</p>
<h1><a class="anchor" id="results"></a>
Results</h1>
<p>We present few results here by using the following Parameter file: </p><div class="fragment"><div class="line"><span class="preprocessor">#parameters file</span></div><div class="line"><span class="preprocessor">#1. Thermal modeling of cylindrical lithium ion battery during discharge cycle, Dong Hyup Jeon ⇑,1, Seung Man Baek,2011,Energy Conversion and Management LiC6</span></div><div class="line"><span class="preprocessor"># 2. Numerical study on lithium titanate battery thermal response under adiabatic condition,Qiujuan Sun a, Qingsong Wanga 2015, Energy Conversion and Management</span></div><div class="line"><span class="preprocessor">#3.white Theoretical Analysis of Stresses in a Lithium Ion Cell    </span></div><div class="line"><span class="preprocessor">#4 A Computational Model of the Mechanical Behavior within Reconstructed LixCoO2 Li-ion Battery Cathode Particles, Veruska Malavé, J.R. Berger, EA</span></div><div class="line"><span class="preprocessor">#5. A pseudo three-dimensional electrochemicalethermal model of a prismatic LiFePO4 battery during discharge process</span></div><div class="line"><span class="preprocessor">#6. solid diffusion Single-Particle Model for a Lithium-Ion Cell: Thermal Behavior, Meng Guo,a Godfrey Sikha,b,* and Ralph E. Whitea</span></div><div class="line"><span class="preprocessor">#global parameters</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#declare problem setting</span></div><div class="line">subsection Problem</div><div class="line">set print_parameter = <span class="keyword">true</span></div><div class="line">set dt = 0.5</div><div class="line">set totalTime = 370</div><div class="line">set step_load = <span class="keyword">true</span></div><div class="line"></div><div class="line">set first_domain_id = 1</div><div class="line">set active_material_id=1</div><div class="line">set electrolyte_id=2</div><div class="line">set current_collector_id=3</div><div class="line">set binder_id=3 </div><div class="line">set solid_id=4</div><div class="line"></div><div class="line">set active_material_fe=0</div><div class="line">set electrolyte_fe=1</div><div class="line">set current_collector_fe=2</div><div class="line">set binder_fe=2<span class="comment">//not necessary</span></div><div class="line">set solid_fe=3</div><div class="line"></div><div class="line"></div><div class="line"><span class="preprocessor">#directory</span></div><div class="line">set mesh = /home/wzhenlin/workspace/batteryCode/mesh/2D/2D_R10_labeled.inp</div><div class="line">set output_directory = output/</div><div class="line">set snapshot_directory = snapshot/ </div><div class="line"><span class="preprocessor">#FEM</span></div><div class="line">set volume_quadrature = 4 </div><div class="line">set face_quadrature = 3 </div><div class="line"><span class="preprocessor">#applied current</span></div><div class="line">set IpA = -350 </div><div class="line">end</div><div class="line"></div><div class="line"><span class="preprocessor"># some useful geometry information beforehand</span></div><div class="line">subsection Geometry</div><div class="line">set X_0 = -13</div><div class="line">set Y_0 = 0</div><div class="line">set Z_0 = 0</div><div class="line">set X_end = 13 </div><div class="line">set Y_end = 153</div><div class="line">set Z_end = 0</div><div class="line"></div><div class="line">set electrode_Y1 = 76</div><div class="line">set electrode_Y2 = 99</div><div class="line">set currentCollector_Y1 = 16</div><div class="line">set currentCollector_Y2 = 144</div><div class="line">set particle_R = 10</div><div class="line">set particle_number = 15</div><div class="line">end</div><div class="line"></div><div class="line"><span class="preprocessor"># initial condition</span></div><div class="line">subsection Initial condition</div><div class="line">set c_li_max_neg = 28.7e-3</div><div class="line">set c_li_max_pos = 37.5e-3</div><div class="line">set c_li_100_neg = 0.915</div><div class="line">set c_li_100_pos = 0.022</div><div class="line">set c_li_0_neg = 0.02</div><div class="line">set c_li_0_pos = 0.98</div><div class="line">set c_li_plus_ini = 1.0e-3</div><div class="line">set T_0 = 298</div><div class="line">end</div><div class="line"></div><div class="line"><span class="preprocessor"># parameter for elastiticy equations</span></div><div class="line">subsection Elasticity</div><div class="line">set youngsModulus_Al = 70e3 #cite5</div><div class="line">set youngsModulus_Cu = 120e3 #cite5 </div><div class="line">set youngsModulus_binder = 2.3e3</div><div class="line">set youngsModulus_s_neg = 12e3 #cite 3 in porosity paper</div><div class="line">set youngsModulus_s_pos = 370e3 #cite4</div><div class="line">set youngsModulus_sep = 0.5e3 #cite 3 in porosity paper</div><div class="line"></div><div class="line">set nu_Al = 0.35</div><div class="line">set nu_Cu = 0.34</div><div class="line">set nu_binder = 0.3 </div><div class="line">set nu_sep = 0.35 #cite 3 in porosity paper</div><div class="line">set nu_s_neg = 0.3 #cite 3 in porosity paper</div><div class="line">set nu_s_pos = 0.2 #cite4 </div><div class="line"></div><div class="line">set omega_c = 3.5 #not used but 3.5 is from linear coff in porosity paper</div><div class="line"><span class="preprocessor">#following from cite 3 in porosity paper</span></div><div class="line">set omega_t_s_neg = 8.62e-6 </div><div class="line">set omega_t_s_pos = 4.06e-6</div><div class="line">set omega_t_sep = 13.32e-5</div><div class="line">set omega_t_Al = 23.6e-6</div><div class="line">set omega_t_Cu = 17e-6</div><div class="line">set omega_t_binder = 190e-6 </div><div class="line">end</div><div class="line"></div><div class="line"><span class="preprocessor">#parameter for fluid equations</span></div><div class="line">subsection Fluid</div><div class="line">set viscosity = 1.0 #original data is 1.0e-9, but scaled to 1.0</div><div class="line">set youngsModulus_mesh = 1.0e3</div><div class="line">set nu_mesh = 0.3</div><div class="line">end</div><div class="line"></div><div class="line"><span class="preprocessor"># parameter for electro-chemo equations</span></div><div class="line">subsection ElectroChemo #cite6</div><div class="line">set sigma_s_neg = 1.5e8</div><div class="line">set sigma_s_pos = 0.5e8</div><div class="line">set sigma_Al = 3.5e9</div><div class="line">set sigma_Cu = 6e9</div><div class="line">set sigma_binder =1e8</div><div class="line"></div><div class="line">set t_0 = 0.2</div><div class="line">set D_li_neg = 5e-1 #cite 40 in porosity paper in code use expression cite 3 </div><div class="line">set D_li_pos = 1.0e-1 #cite3</div><div class="line"></div><div class="line"><span class="preprocessor"># parameter for Butler-Volmer equations at ElectricChemo class</span></div><div class="line">set F = 96485.3329</div><div class="line">set Rr = 8.3144598</div><div class="line">set alpha_a = 0.5</div><div class="line">set alpha_c = 0.5</div><div class="line">set k_neg = 0.8 #to match porosity paper</div><div class="line">set k_pos = 0.8 #to match porosity paper</div><div class="line">set c_max_neg = 28.7e-3</div><div class="line">set c_max_pos = 37.5e-3</div><div class="line"></div><div class="line">end</div><div class="line"></div><div class="line"><span class="preprocessor"># parameter for thermal equations</span></div><div class="line">subsection Thermal</div><div class="line">set lambda_s_neg = 5e6 #cite1</div><div class="line">set lambda_s_pos = 1.85e6  #cite1</div><div class="line">set lambda_e = 0.33e6  #cite2</div><div class="line">set lambda_sep = 1e6  #cite1</div><div class="line">set lambda_Al = 160e6  #cite5</div><div class="line">set lambda_Cu = 400e6  #cite5</div><div class="line">set lambda_binder = 0.19e6 #PVDF</div><div class="line"></div><div class="line">set density_s_neg = 5.03e-15  #cite1</div><div class="line">set density_s_pos = 2.29e-15  #cite1</div><div class="line">set density_sep = 1.2e15  #cite1</div><div class="line">set density_e = 1e-15  #cite2</div><div class="line">set density_Al = 2.7e-15  #cite5</div><div class="line">set density_Cu = 8.9e-15  #cite5</div><div class="line">set density_binder = 1.78e-15  #cite5</div><div class="line"></div><div class="line">set Cp_s_neg = 0.7e12  #cite1</div><div class="line">set Cp_s_pos = 1.17e12  #cite1</div><div class="line">set Cp_e = 1978.16e12  #cite2</div><div class="line">set Cp_sep = 700e12  #cite1</div><div class="line">set Cp_Al = 903e12  #cite5</div><div class="line">set Cp_Cu = 385e12  #cite5</div><div class="line">set Cp_binder = 700e12 </div><div class="line"></div><div class="line">set h = 5 #Heat transfer coefficient</div><div class="line">end</div><div class="line">            </div><div class="line">                    </div><div class="line"><span class="preprocessor">#==============================================================================</span></div><div class="line"><span class="preprocessor"># parameters reserved for deal.ii first level code:</span></div><div class="line"><span class="preprocessor">#nonLinear_method : classicNewton</span></div><div class="line"><span class="preprocessor">#solver_method (direct) : PETScsuperLU, PETScMUMPS</span></div><div class="line"><span class="preprocessor">#solver_method (iterative) : PETScGMRES PETScBoomerAMG</span></div><div class="line"><span class="preprocessor">#relative_norm_tolerance, absolute_norm_tolerance, max_iterations</span></div><div class="line"><span class="preprocessor">#</span></div><div class="line">subsection Nonlinear_solver</div><div class="line">        set nonLinear_method = classicNewton</div><div class="line">        set relative_norm_tolerance = 1.0e-16</div><div class="line">        set absolute_norm_tolerance = 1.0e-7</div><div class="line">        set max_iterations = 60</div><div class="line">end</div><div class="line">                        </div><div class="line">subsection Linear_solver</div><div class="line">        set solver_method = PETScsuperLU</div><div class="line">        set system_matrix_symmetricFlag = <span class="keyword">false</span> # <span class="keywordflow">default</span> is <span class="keyword">false</span></div><div class="line">end</div></div><!-- fragment --><p>  <style>div.image img[src="C_li_293.png"]{width:500px;}</style>  </p><div class="image">
<img src="C_li_293.png" alt="C_li_293.png"/>
<div class="caption">
Lithium concentration under different far-field boundary conditions and intercalation strain as-sumptions</div></div>
<p> <style>div.image img[src="C_li_plus_293.png"]{width:500px;}</style>  </p><div class="image">
<img src="C_li_plus_293.png" alt="C_li_plus_293.png"/>
<div class="caption">
Lithium ion concentration under different far-field boundary conditions and intercalation strain as-sumptions</div></div>
<p> <style>div.image img[src="v_293.png"]{width:500px;}</style>  </p><div class="image">
<img src="v_293.png" alt="v_293.png"/>
<div class="caption">
Velocity of electrolyte under different far-field boundary conditions and intercalation strain as-sumptions</div></div>
<p> The complete implementaion can be found at <a href="https://github.com/mechanoChem/mechanoChemFEM/tree/example/Example3%20Battery%20model%20at%20particle%20scale">Github</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
